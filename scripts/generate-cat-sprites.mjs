// Generates idle.png spritesheet from the hardcoded cat pixel data.
// Run: node scripts/generate-cat-sprites.mjs

import { createCanvas } from "canvas";
import { writeFileSync, mkdirSync } from "fs";
import { dirname } from "path";

const PALETTE = {
  0: [0, 0, 0, 0],         // transparent
  1: [0x1a, 0x1a, 0x2e, 255], // outline / dark
  2: [0xf4, 0xa0, 0x35, 255], // orange fur
  3: [0xff, 0xea, 0xa7, 255], // cream / light belly
  4: [0xfd, 0x79, 0xa8, 255], // pink nose + inner ears
  5: [0xe1, 0x70, 0x55, 255], // dark orange / stripes
  6: [0xff, 0xff, 0xff, 255], // eye whites
  7: [0x2d, 0x34, 0x36, 255], // pupils
};

const IDLE_0 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0],
  [0,1,4,2,1,0,0,0,0,1,2,4,1,0,0,0],
  [0,1,2,2,2,1,1,1,1,2,2,2,1,0,0,0],
  [0,0,1,2,5,2,2,2,2,5,2,1,0,0,0,0],
  [0,0,1,6,7,1,2,2,1,6,7,1,0,0,0,0],
  [0,0,1,2,2,2,4,4,2,2,2,1,0,0,0,0],
  [0,0,0,1,2,3,3,3,3,2,1,0,0,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,1,5,2,2,2,2,2,2,5,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,1,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,1,1,0,0],
  [0,0,0,1,2,1,0,0,1,2,1,0,0,1,0,0],
  [0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

const IDLE_1 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0],
  [0,1,4,2,1,0,0,0,0,1,2,4,1,0,0,0],
  [0,1,2,2,2,1,1,1,1,2,2,2,1,0,0,0],
  [0,0,1,2,5,2,2,2,2,5,2,1,0,0,0,0],
  [0,0,1,2,1,1,2,2,1,1,2,1,0,0,0,0],
  [0,0,1,2,2,2,4,4,2,2,2,1,0,0,0,0],
  [0,0,0,1,2,3,3,3,3,2,1,0,0,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,1,5,2,2,2,2,2,2,5,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,1,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,1,1,0,0],
  [0,0,0,1,2,1,0,0,1,2,1,0,0,1,0,0],
  [0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

const IDLE_2 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0],
  [0,1,4,2,1,0,0,0,0,1,2,4,1,0,0,0],
  [0,1,2,2,2,1,1,1,1,2,2,2,1,0,0,0],
  [0,0,1,2,5,2,2,2,2,5,2,1,0,0,0,0],
  [0,0,1,6,7,1,2,2,1,6,7,1,0,0,0,0],
  [0,0,1,2,2,2,4,4,2,2,2,1,0,0,0,0],
  [0,0,0,1,2,3,3,3,3,2,1,0,0,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,1,5,2,2,2,2,2,2,5,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,0,1,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,1,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0],
  [0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

const IDLE_3 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0],
  [0,0,1,4,2,1,0,0,0,1,2,4,1,0,0,0],
  [0,0,1,2,2,2,1,1,1,2,2,2,1,0,0,0],
  [0,0,0,1,2,5,2,2,5,2,2,1,0,0,0,0],
  [0,0,0,1,6,7,1,2,1,6,7,1,0,0,0,0],
  [0,0,0,1,2,2,4,4,2,2,2,1,0,0,0,0],
  [0,0,0,0,1,3,3,3,3,2,1,0,0,0,0,0],
  [0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,1,5,2,2,2,2,2,2,5,1,0,0,0,0],
  [0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0],
  [0,1,1,2,2,2,3,3,2,2,2,1,0,0,0,0],
  [1,1,0,1,2,2,2,2,2,2,1,0,0,0,0,0],
  [0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0],
  [0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

const FRAMES = [IDLE_0, IDLE_1, IDLE_2, IDLE_3];
const SPRITE_SIZE = 16;
const NUM_FRAMES = FRAMES.length;

const canvas = createCanvas(SPRITE_SIZE * NUM_FRAMES, SPRITE_SIZE);
const ctx = canvas.getContext("2d");

for (let f = 0; f < NUM_FRAMES; f++) {
  const frame = FRAMES[f];
  const offsetX = f * SPRITE_SIZE;
  for (let y = 0; y < SPRITE_SIZE; y++) {
    for (let x = 0; x < SPRITE_SIZE; x++) {
      const colorIndex = frame[y][x];
      const [r, g, b, a] = PALETTE[colorIndex];
      if (a === 0) continue;
      ctx.fillStyle = `rgba(${r},${g},${b},${a / 255})`;
      ctx.fillRect(offsetX + x, y, 1, 1);
    }
  }
}

const outPath = "src-tauri/resources/pets/cat/sprites/idle.png";
mkdirSync(dirname(outPath), { recursive: true });
const buffer = canvas.toBuffer("image/png");
writeFileSync(outPath, buffer);
console.log(`Written ${outPath} (${canvas.width}x${canvas.height}, ${buffer.length} bytes)`);
